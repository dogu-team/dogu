---
sidebar_position: 3
title: 작성
locale: ko
---

테스트 스크립트 저장소를 Clone 받으면 기본적인 템플릿 프로젝트가 준비되어 있습니다.<br/>

:::caution
테스트 스크립트는 `Dest` 라이브러리를 사용해 스크립트를 작성하고 실행하는 방법에 대해서 설명합니다.<br/>
`Gamium` 테스트 스크립트를 작성하는 방법에 대해서는 [Gamium 문서](https://gamium.dogutech.io/docs/get-started/introduction)를 참고해주세요.
:::

:::info 테스트 스크립트 디렉터리 설정
`dost.config.json` 설정 파일 내 `scriptFolderPaths`에 테스트 스크립트 디렉터리들을 설정합니다.<br/>
기본적으로 `test` 디렉터리가 설정되어 있습니다.
:::

## Dest 라이브러리 설명

각 test(테스트 케이스)와 테스트 케이스들의 집합인 job(테스트 스위트)를 작성할 때 사용하는 라이브러리입니다.<br/>
Dest 라이브러리를 사용해 테스트 스크립트를 작성하면 루틴을 실행한 후 결과 보고서에서 테스트 케이스의 실행 결과를 확인할 수 있습니다.

### `Dest.describe((context: DestContext) => void)`

`describe()`는 테스트 집합을 생성하기 위한 함수입니다.<br/>
context에는 dest 내부에서 사용하는 logger가 포함되어 있습니다.

### `Dest.withOptions(options: DestOptions).describe((context: DestContext) => void)`

`withOptions()`를 사용하면 기본 옵션 대신 옵션 값을 변경할 수 있습니다. <br/>
옵션은 아래에서 설명합니다.

### `job(name, () => void)`

`job()`은 테스트 케이스들의 집합입니다.<br/>
최소한 하나의 job이 필요합니다.<br/>
job은 중첩될 수 있습니다.

### `test(name, () => Promise<void> | void)`

`test()`는 테스트 케이스를 실행하는 함수입니다.<br/>
job 내부에서만 사용할 수 있습니다.<br/>
테스트 케이스가 실패하면 다음 테스트 케이스는 실행되지 않고 job은 실패합니다.

### `beforeAll(() => Promise<void> | void)`

같은 레벨의 모든 테스트들이 실행되기 전에 실행됩니다.

### `afterAll(() => Promise<void> | void)`

같은 레벨의 모든 테스트들이 실행된 후에 실행됩니다.

### `beforeEach(() => Promise<void> | void)`

같은 레벨의 각 테스트들이 실행되기 전에 실행됩니다.

### `afterEach(() => Promise<void> | void)`

같은 레벨의 각 테스트들이 실행된 후에 실행됩니다.

## 옵션

| 속성      | 필수/선택 | 타입    | 기본값 | 설명                |
| :-------- | :-------- | :------ | :----- | :------------------ |
| timeout   | 선택      | number  | 60000  | 실행 시간 제한(ms)  |
| logToFile | 선택      | boolean | false  | 로그 파일 저장 여부 |

## 사용 가이드

### 기본 옵션으로 실행

만약 `Dest.withOptions()`를 사용하지 않으면 기본 옵션으로 실행됩니다.

```typescript
import { Dest, job, test } from '@dogu-tech/dest';

Dest.describe(({ logger }) => {
  job('my first test', () => {
    test('my first test case', () => {
      logger.info('hello world');
    });
  });
});
```

### 옵션 변경 후 실행

만약 `Dest.withOptions()`를 사용하면 기본 옵션 대신 옵션 값을 변경할 수 있습니다.<br/>

```typescript
import { Dest, job, test } from '@dogu-tech/dest';

Dest.withOptions({
  timeout: 60 * 60 * 1000, // 1 hour
  logToFile: true,
}).describe(({ logger }) => {
  job('my first test', () => {
    test('my first test case', () => {
      logger.info('hello world');
    });
  });
});
```

### job이 없는 경우

최소한 하나의 job이 필요합니다.<br/>
만약 job이 없으면 예외가 발생합니다.

```typescript
import { Dest, job, test } from '@dogu-tech/dest';

Dest.describe(({ logger }) => {
  // ❌ this will throw an error. you must use job() to create a job.
  test('my first test case', () => {
    logger.info('hello world');
  });

  // ✅ this is ok.
  job('my first job', () => {
    test('my first test case', () => {
      logger.info('hello world');
    });
  });
});
```

### 중첩된 job이 있는 경우

```typescript
import { Dest, job, test } from '@dogu-tech/dest';

Dest.describe(({ logger }) => {
  // ✅ nested jobs
  job('my first test', () => {
    job('my nested test', () => {
      test('my second test case', () => {
        logger.info('hello world');
      });
    });
  });

  // ❌ nested tests. this will throw an error.
  job('my second test', () => {
    test('my second test case', () => {
      test('my nested test case', () => {
        logger.info('hello world');
      });
    });
  });
});
```

### beforeAll, afterAll을 사용한 경우

준비 작업이나 정리 작업을 위해 사용할 수 있습니다.

```typescript
import { afterAll, beforeAll, Dest, job, test } from '@dogu-tech/dest';

Dest.describe(({ logger }) => {
  job('my first test', () => {
    beforeAll(() => {
      logger.info('beforeAll');
    });

    // this called after same level tests
    afterAll(() => {
      logger.info('afterAll');
    });

    test('my first test case', () => {
      logger.info('hello world');
    });

    test('my second test case', () => {
      logger.info('hello world');
    });
  });
});
```

출력 결과:

```sh
 my first test
  ✓ beforeAll (0.0s)
  ✓ my first test case (0.0s)
  ✓ my second test case (0.0s)
  ✓ afterAll (0.0s)
```

### beforeEach, afterEach를 사용한 경우

테스트 케이스마다 초기화 작업이나 정리 작업을 위해 사용할 수 있습니다.

```typescript
import { afterEach, beforeEach, Dest, job, test } from '@dogu-tech/dest';

Dest.describe(({ logger }) => {
  job('my first test', () => {
    beforeEach(() => {
      logger.info('beforeEach');
    });

    // this called after each test
    afterEach(() => {
      logger.info('afterEach');
    });

    test('my first test case', () => {
      logger.info('hello world');
    });

    test('my second test case', () => {
      logger.info('hello world');
    });
  });
});
```

출력 결과:

```sh
my first test
  ✓ beforeEach (0.0s)
  ✓ my first test case (0.0s)
  ✓ afterEach (0.0s)
  ✓ beforeEach (0.0s)
  ✓ my second test case (0.0s)
  ✓ afterEach (0.0s)
```

### timeout이 발생한 경우

timeout 옵션을 사용하면 테스트가 실행되는 시간을 제한할 수 있습니다.<br/>
만약 timeout이 발생하면 테스트는 실패로 처리됩니다.

```typescript
import { Dest, job, test } from '@dogu-tech/dest';

Dest.withOptions({
  timeout: 1000, // 1 seconds
}).describe(({ logger }) => {
  job('my first test', () => {
    test('my first test case', () => {
      logger.info('hello world');
    });

    test('my second test case', async () => {
      logger.info('hello world');
      await new Promise((resolve) => setTimeout(resolve, 2000));
    });
  });
});
```

출력 결과:

```sh
  FAIL
 my first test
  ✓ my first test case (0.0s)
  ✕ my second test case (1.0s)
```
